<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="style.css" />
    <title>Hello Twilio Serverless!</title>
</head>

<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        function request_video_call() {
            $("#request_video_call_btn").prop('disabled', true);
            $('#url_obtained').hide();
            // Get a unique code and redirect to url with code.
            // This link could be also generated by an agent or another page somewhere, and sent directly to the client.
            // Here for simplicity we just get the url and redirect to it in the same action.
            fetch("/1-generate-unique-code")
                .then((response) => response.json())
                .then((response) => {
                    $('#url_obtained').show();
                    $('#url_obtained a').prop('href', response.full_url)
                    $('#url_obtained code').text(response.full_url);
                    $('#url_obtained span').text(new Date(Date.parse(response.valid_until)).toLocaleString());
                })
                .finally(() => {
                    $("#request_video_call_btn").prop('disabled', false);
                })
        }

        $(document).ready(function () {
            $("#request_video_call_btn").click(request_video_call);
        });
    </script>
    <header>
        <h1>Hello Twilio Video!</h1>
    </header>

    <main>
        <p>This button will call <code>/1-generate-unique-code</code> and get a unique url.</p>
        <p><button id="request_video_call_btn">Request video call</button></p>
        <p id="url_obtained" style="display: none">URL created: <a href=""><code></code></a> valid until <span></span>.
        </p>
    </main>

    <footer>
        <p>
            Made with ðŸ’–&nbsp; by your friends at
            <a href="https://www.twilio.com">Twilio</a>
        </p>
    </footer>
</body>

</html>